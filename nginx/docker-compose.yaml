networks:
  appnet:
    external: true
    name: marc_appnet

x-log-options: &marc-log-options
  driver: k8s-file
  options: &marc-log-driver-options
    max_size: 10m
    max_file: 5

services:
  nginx:
    container_name: nginx
    image: nginx:1.27-alpine
    restart: unless-stopped
    logging:
      <<: *marc-log-options
      options:
        <<: *marc-log-driver-options
        path: /var/log/marc/nginx.log
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # The :ro,Z suffix makes the file read-only and relabels it for SELinux
      # The 'Z' is important to make the container read the file from the system
      # instead of trying to read a cached version.
      - ./nginx.conf:/etc/nginx/nginx.conf:ro,Z
      - /var/log/marc:/var/log/marc
      - /srv/nginx/certs/wildcard/CLIENT:/nginx/ssl-certificates-client/wildcard/CLIENT:ro,Z
    networks: [appnet]
